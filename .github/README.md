# üìö WebCorsProxy - CI/CD Documentation

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#—Ä–∞–±–æ—á–∏–π-–ø—Ä–æ—Ü–µ—Å—Å-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
4. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
5. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–æ—Ç–ª–∞–¥–∫–∞)
6. [FAQ](#faq)

---

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
   ```bash
   git clone https://github.com/AzerQ/WebCorsProxy.git
   cd WebCorsProxy
   ```

2. **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**
   ```bash
   dotnet run
   # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ http://localhost:5000
   ```

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Docker –ª–æ–∫–∞–ª—å–Ω–æ**
   ```bash
   # Linux/Mac
   ./test-docker.sh
   
   # Windows
   .\test-docker.ps1
   ```

### –î–ª—è DevOps/–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub Secrets** (—Å–º. [QUICKSTART.md](.github/QUICKSTART.md))
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ push –≤ main** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å** –≤ GitHub Actions

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

```
WebCorsProxy/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy.yml              # –û—Å–Ω–æ–≤–Ω–æ–π workflow (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy-ghcr.yml         # –° GitHub Container Registry
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md               # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
‚îÇ   ‚îú‚îÄ‚îÄ QUICKSTART.md               # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (—á–µ–∫–ª–∏—Å—Ç)
‚îú‚îÄ‚îÄ Pipelines/                      # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ Configuration/                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
‚îú‚îÄ‚îÄ appsettings.json               # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ appsettings.Production.json    # Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile                      # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml             # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ test-docker.sh/ps1             # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ test-api.sh                    # API —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ README.md                      # –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **appsettings.json** - –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¥–ª—è dev)
- **appsettings.Production.json** - Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **.env.example** - –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **docker-compose.yml** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Docker Compose

---

## üìã –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è —Ñ–∏—á–∏
git checkout -b feature/new-feature

# –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
# ... –≤–∞—à –∫–æ–¥ ...

# –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
dotnet test
./test-docker.sh

# –ö–æ–º–º–∏—Ç –∏ push
git add .
git commit -m "feat: add new feature"
git push origin feature/new-feature

# –°–æ–∑–¥–∞–π—Ç–µ Pull Request
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –º–µ—Ä–∂–µ–º

- ‚úÖ –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è: `dotnet build`
- ‚úÖ Docker –æ–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è: `./test-docker.sh`
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç: `./test-api.sh`
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: `dotnet test`

### 3. –ú–µ—Ä–∂ –≤ main

```bash
# –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è PR
git checkout main
git pull origin main
git merge feature/new-feature
git push origin main

# üìö –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –¥–µ–ø–ª–æ–π!
```

---

## üìã –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ (—á–µ—Ä–µ–∑ GitHub Actions)

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ –≤–µ—Ç–∫—É `main`
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Actions ‚Üí "Run workflow"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. ‚úì Checkout –∫–æ–¥–∞
2. ‚öôÔ∏è –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞
3. ‚öôÔ∏è –£–ø–∞–∫–æ–≤–∫–∞ –æ–±—Ä–∞–∑–∞
4. ‚öôÔ∏è –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
5. ‚öôÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
6. ‚öôÔ∏è –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
7. ‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –°—Ç–∞—Ç—É—Å –≤ GitHub: Actions ‚úì Deploy to Production
- –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### –†—É—á–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
ssh user@server
cd ~/webcorsproxy

# –ü–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose down
docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker-compose ps
docker-compose logs -f
```

### –û—Ç–∫–∞—Ç –≤–µ—Ä—Å–∏–∏

```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—Ä–∞–∑—ã
docker images webcorsproxy

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é
docker stop proxyserver
docker rm proxyserver
docker run -d --name proxyserver \
  --restart unless-stopped \
  -p 8000:8080 \
  -v ~/webcorsproxy/appsettings.json:/app/appsettings.json:ro \
  webcorsproxy:PREVIOUS_IMAGE_ID
```

---

## üìã –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps | grep proxyserver

# –õ–æ–≥–∏
docker logs proxyserver
docker logs -f proxyserver  # –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

# –†–µ—Å—É—Ä—Å—ã
docker stats proxyserver

# –¢–µ—Å—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
curl http://localhost:8000/
curl http://localhost:8000/proxy?url=https://example.com
```

### API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
./test-api.sh

# –ù–∞ production —Å–µ—Ä–≤–µ—Ä–µ
SERVER_URL=https://your-domain.com API_TOKEN=your-token ./test-api.sh
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**
```bash
# –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏
docker logs proxyserver

# –ó–∞–ø—É—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ
docker run -it --rm -p 8000:8080 webcorsproxy:latest
```

**–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫
cat ~/webcorsproxy/appsettings.json

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
docker exec proxyserver cat /app/appsettings.json
```

**Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Nginx
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/error.log
```

---

## ‚ùì FAQ

### Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è?
**A:** –ò–∑–º–µ–Ω–∏—Ç–µ –≤ `docker-compose.yml`:
```yaml
ports:
  - "8000:8080"  # –í–Ω–µ—à–Ω–∏–π:–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π
```

### Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π API –∫–ª—é—á?
**A:** –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `appsettings.json` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```json
{
  "ApiKeys": [
    "key-1",
    "key-2",
    "new-key"
  ]
}
```
–ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `docker restart proxyserver`

### Q: –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞?
**A:**
```bash
# –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–∞
docker inspect proxyserver | grep Created

# –ò–ª–∏ —á–µ—Ä–µ–∑ GitHub Actions
# Actions ‚úì Deploy to Production ‚û°Ô∏è Latest run
```

### Q: –ö–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä?
**A:**
1. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É SSH –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
2. –û–±–Ω–æ–≤–∏—Ç–µ GitHub Secrets —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–µ–ø–ª–æ–π

### Q: –ú–æ–∂–Ω–æ –ª–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤?
**A:** –î–∞! –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ `docker-compose.yml`:
```yaml
services:
  proxyserver-1:
    ports:
      - "8000:8080"
  proxyserver-2:
    ports:
      - "8001:8080"
```

### Q: –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å HTTPS?
**A:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Nginx —Å Let's Encrypt:
```bash
sudo certbot --nginx -d your-domain.com
```
–°–º. [DEPLOYMENT.md](.github/DEPLOYMENT.md#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-https)

### Q: Workflow –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π SSH
**A:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. ‚û°Ô∏è SSH –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ GitHub Secrets
2. ‚û°Ô∏è –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (`~/.ssh/authorized_keys`)
3. ‚û°Ô∏è –ü—Ä–∞–≤–∞ –Ω–∞ –∫–ª—é—á: `chmod 600 ~/.ssh/authorized_keys`
4. ‚û°Ô∏è SSH –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç –≤ firewall

### Q: –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π?
**A:** 
–í–∞—Ä–∏–∞–Ω—Ç 1: –£–¥–∞–ª–∏—Ç–µ `.github/workflows/deploy.yml`
–í–∞—Ä–∏–∞–Ω—Ç 2: –ò–∑–º–µ–Ω–∏—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä –≤ workflow:
```yaml
on:
  workflow_dispatch:  # –¢–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
```

---

## üìã –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [QUICKSTART.md](.github/QUICKSTART.md) - –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç
- [DEPLOYMENT.md](.github/DEPLOYMENT.md) - –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [README.md](../README.md) - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- [GitHub Actions](https://github.com/AzerQ/WebCorsProxy/actions) - –°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ–µ–≤

---

## üìã –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **Issues**: https://github.com/AzerQ/WebCorsProxy/issues
- **Pull Requests**: https://github.com/AzerQ/WebCorsProxy/pulls
- **Discussions**: https://github.com/AzerQ/WebCorsProxy/discussions

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2024
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: 1.0
